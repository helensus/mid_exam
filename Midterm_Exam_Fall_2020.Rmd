---
title: "Midterm Exam"
author: "Your Name"
date: "11/2/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load(
ggplot2,
rstanarm,
pwr,
dplyr,
psych
)
```

## Instruction

This is your midterm exam that you are expected to work on it alone.  You may NOT  discuss any of the content of your exam with anyone except your instructor. This includes text, chat, email and other online forums.  We expect you to respect and follow the [GRS Academic and Professional Conduct Code](http://www.bu.edu/cas/files/2017/02/GRS-Academic-Conduct-Code-Final.pdf). 

Although you may NOT ask anyone directly, you are allowed to use external resources such as R codes on the Internet.  If you do use someone's code, please make sure you clearly cite the origin of the code.

When you finish, please compile and submit the PDF file and the link to the GitHub repository that contains the entire analysis.


## Introduction

In this exam, you will act as both the client and the consultant for the data that you collected in the data collection exercise (20pts).  Please note that you are not allowed to change the data.  The goal of this exam is to demonstrate your ability to perform the statistical analysis that you learned in this class so far.  It is important to note that significance of the analysis is not the main goal of this exam but the focus is on the appropriateness of your approaches.

### Data Description (10pts)

Please explain what your data is about and what the comparison of interest is.  In the process, please make sure to demonstrate that you can load your data properly into R.

*The question I want to discuss is how long people use phones daily. I set up two groups, workers and students to see which group spend more time on phones. I made a survey to collect data about their daily usage of phones. I put up the survey link to my friends and post it online in a survey help website to get more responses.
Out of the surveys I collected, 5 of them is unreliable as most blankets are blank while submitted. So I deleted those 5 lines.
Explanations of columns:
Group: 1 implies they are in the group of students, 2 implies that they are in the group of working.
Charge: Times of charging the phone in one day.
Use: duration of phone using in one day
Open: times of opening the phone and unlocking it in one day.

It would be very interesting to see the condition of phone usage of the workers and students.

```{r }
phone.raw <- read_csv("Data collection.csv", col_names = TRUE)
phone<-na.omit(phone.raw)
phone<-select(phone,Group, Charge,Use,Open)
Open.max=max(phone$Open)
phone$Open<- as.numeric(phone$Open)
for(i in 1:row_number(phone)){
  if (phone[i,4]=="n") { phone[i,4]<-Open.max}
  else if (phone[i,4]=="na") {phone[i,4]<- NULL}
}
phone<-na.omit(phone)
```

### EDA (10pts)

Please create one (maybe two) figure(s) that highlights the contrast of interest.  Make sure you think ahead and match your figure with the analysis.  For example, if your model requires you to take a log, make sure you take log in the figure as well.


```{r }
colors = ifelse(phone$Group==1,"magenta","turquoise")
ggplot(data=phone) +geom_point(aes(y=Use,x=Charge,col=colors))
ggplot(data=phone, aes(y=Use,x=Charge,group=Group)) + 
    geom_boxplot()+
  facet_wrap(~Group)
by(phone, phone$Group,describe)
# phone%>%ggpairs(upper = list(continuous = wrap("cor")), 
#                    lower = list(continuous = wrap("smooth", alpha = 0.3)),
#                    diag = list(continuous = wrap("barDiag"), binwidth = 1),
#                    mapping = aes(color = Group))
```



### Power Analysis (10pts)

Please perform power analysis on the project.  Use 80% power, the sample size you used and infer the level of effect size you will be able to detect.  Discuss whether your sample size was enough for the problem at hand.  Please note that method of power analysis should match the analysis.  Also, please clearly state why you should NOT use the effect size from the fitted model.

```{r }
phone%>% group_by(Group)%>%summarise(mean=mean(Charge), sd=sd(Charge))
phone%>% group_by(Group)%>%summarise(mean=mean(Use), sd=sd(Use))
phone%>% group_by(Group)%>%summarise(mean=mean(Open), sd=sd(Open))
d1=abs(1.74-1.32)/sqrt(0.70^2+0.65^2)
d2=abs(6.92-5.80)/sqrt(2.58^2+2.72^2)
d3=abs(34.57-19.61)/sqrt(25.16^2+13.69^2)
pwr.t.test(d=d1, power=0.8, sig.level = 0.05, type = 'two.sample')
pwr.t.test(d=d2, power=0.8, sig.level = 0.05, type = 'two.sample')
pwr.t.test(d=d3, power=0.8, sig.level = 0.05, type = 'two.sample')
```

As the test power calculation result shows, the optimized size is n=82,176,58 for each group. The sample size I have is not enough for the problem to discuss. As the data I could collected is limited so far, although the size is not enough, I would use the current data to do the analysis.

### Modeling (10pts)

Please pick a regression model that best fits your data and fit your model.  Please make sure you describe why you decide to choose the model. Also, if you are using GLM, make sure you explain your choice of link function as well.
```{r }
# model1<-lm(Use~Charge, data=phone)
# print(model1)
# 
# par(mar=c(3,3,2,1), mgp=c(2,.7,0), tck=-.01) 
# plot(phone$Use, phone$Charge)
# abline(coef(model1))

# ggplot(data = Pollution, aes(x=log(nox),y = mort))+ geom_point()+
# geom_smooth(formula = "y~x", method = "lm")



model2<-stan_glm(Use~Charge+Open+Group, data=phone,refresh=0)
print(model2)
# 
# b_hat <- coef(model2)
# colors = ifelse(phone$Group==1,"magenta","turquoise")
# par(mar=c(3,3,2,1), mgp=c(2,.7,0), tck=-.01) 
# plot(beauty$beauty,beauty$eval,main="Problem 10.6b Beauty Model",pch=20,col=colors) 
# abline(b_hat[1] + b_hat[3],b_hat[2]+b_hat[4],col="magenta") 
# abline(b_hat[1],b_hat[2],col="turquoise")
```


### Validation (10pts)

Please perform a necessary validation and argue why your choice of the model is appropriate.  

```{r }

```


### Inference (10pts)

Based on the result so far please perform statistical inference to compare the comparison of interest.

```{r }

```

参数理解
*Let’s look at our coefficients. Effectively, if the professor is male with average beauty, they would be expected to have an evaluation of 4.1. The slope coefficient of 0.2 means that professors with 1 more point in beauty score seem to have evaluations 0.2 points higher.
In comparison, female professors with average beauty are expected to have an average evaluation 0.2 lower than males, at 3.9. Their slope is also lowered to 0.1, meaning it has a lower rate of change. The standard deviation for this coefficient estimation is high, though, so the conclusions around this may be unstable.
Let’s visualize it! Let’s make the magenta females and turquoise non-females.

### Discussion (10pts)

Please clearly state your conclusion and the implication of the result.

*Comparing the group of students and workers, the students on average charge phones 1.75 times a day, while workers charge their phone 1.33 times a day. Students generally spend more time on phones than workers, while the maximum using time of students is 12, less than the maximum using time of 14 in the group of workers. 
Comparing the standard deviations,  there is not a large difference about their charging times and using time. The distribution of times of opening the phone in one day for students is much more decentralized.

### Limitations and future opportunity. (10pts)

Please list concerns about your analysis.  Also, please state how you might go about fixing the problem in your future study.

*First of all, the data collected is not enough for the 80% poter test comparison.
Then there is no significant result in the linear regression model for .....


### Comments or questions
If you have any comments or questions, please write them here.

